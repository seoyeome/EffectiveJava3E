## Item67. 최적화는 신중히 하라

ㅋㅋㅋㅋㅋㅋㅋㅋㅋㅋㅋ격언 세개 개웃겨

### 빠른 프로그램보다는 좋은 프로그램을 작성하라.
- 좋은 프로그램은 정보 은닉 원칙을 따르므로 개별 구성요소의 내부를 독립적으로 설계할 수 있다.
- 시스템의 나머지에 영향을 주지 않고도 각 요소를 다시 설계할 수 있다
- 설계 단계에서 성능을 반드시 염두에 두어야 한다.

### 성능을 제한하는 설계를 피하라.
- 완성 후 변경하기가 가장 어려운 설계 요소는 바로 컴포넌트끼리, 혹은 외부 시스템과의 소통 방식이다. API, 네트워크 프로토콜, 영구 저장용 데이터 포맷 등이 대표적이다.
- 설게 요소들은 완성후에는 변경하기 어렵거나 불가능할 수 있으며, 동시에 시스템 성능을 심각하게 제한할 수 있다.

```
영구 저장용 데이터 포맷(permanent storage data format)은 컴퓨터 시스템에서 데이터를 장기간 저장하기 위해 사용되는 데이터 구조 및 파일 형식을 말합니다.

이러한 포맷은 데이터를 디스크, SSD, 클라우드 스토리지와 같은 저장 매체에 저장할 때 사용되며, 데이터의 무결성, 접근 속도, 호환성, 보안 등을 고려하여 설계됩니다.

대표적인 영구 저장용 데이터 포맷의 예시는 다음과 같습니다:

데이터베이스 포맷: 관계형 데이터베이스(RDBMS)나 비관계형 데이터베이스(NoSQL)에서 사용되는 데이터 포맷. 예를 들어, SQL 데이터베이스는 테이블 형식을 사용하여 데이터를 저장합니다.

파일 시스템 포맷: 파일과 디렉토리를 저장하고 구성하는 방식. 예를 들어, NTFS, FAT32, ext4 등이 있습니다.

문서 포맷: PDF, DOCX, XLSX 등과 같이 텍스트, 이미지, 다른 미디어 타입을 저장하는 데 사용되는 포맷.

이미지 및 비디오 포맷: JPEG, PNG, GIF, MP4, AVI 등과 같이 이미지 및 비디오 데이터를 저장하는 데 사용되는 포맷.

이러한 포맷들은 다양한 애플리케이션과 시스템 간의 호환성을 위해 표준화되거나 널리 사용되는 규약을 따르는 경우가 많습니다. 디자인 단계에서 이러한 포맷을 결정하는 것은 중요한 작업이며, 일단 결정되면 나중에 변경하기 어렵기 때문에 신중하게 고려해야 합니다.
```

### API를 설계할 때 성능에 주는 영향을 고려하라.
- public 타입을 가변으로 만들면, 즉 내부 데이터를 변경할 수 있게 만들면 불필요한 방어적 복사를 수없이 유발할 수 있다.
- 컴포지션으로 해결할 수 있음에도 상속 방식으로 설계한 public 클래스는 상위 클래스에 영원히 종속되며 그 성능 제약까지도 물려받게 된다.
- 인터페이스도 있는데 굳이 구현 타입을 사용하는 것 역시 좋지 않다. 특정 구현체에 종속되게 하여, 나중에 더 빠른 구현체가 나오더라도 이용하지 못하게 된다.
- API 설계가 성능에 주는 영향은 현실적인 문제다.


### 성능을 위해 API를 왜곡하는 건 매우 안 좋은 생각이다.
```
"성능을 위해 API를 왜곡하는 건 매우 안 좋은 생각이다"라는 말은, API(Application Programming Interface)의 설계를 성능 향상을 위해서만 변경하거나 조정하는 것이 장기적으로 좋지 않은 결과를 초래할 수 있다는 의미입니다. 이는 다음과 같은 이유들 때문입니다:

유지보수의 어려움: API를 성능 최적화를 위해 과도하게 조정하면, 이후에 코드를 유지보수하거나 업데이트하는 데 있어 복잡성이 증가합니다. API가 너무 특정 상황이나 성능 요구사항에만 초점을 맞추게 되면, 일반적인 사용 사례에서의 이해도나 접근성이 떨어질 수 있습니다.

가독성과 이해도 저하: API의 주요 목적 중 하나는 다른 개발자들이 소프트웨어 컴포넌트를 쉽게 사용하고 이해할 수 있게 하는 것입니다. 성능 최적화를 위해 API를 복잡하게 만들면, 이해도와 가독성이 저하되어 다른 개발자들이 사용하기 어려워집니다.

확장성과 유연성 저하: 성능에만 초점을 맞춘 API 설계는 종종 확장성과 유연성을 희생합니다. 이는 장기적으로 새로운 기능을 추가하거나 시스템을 변경하는 데 제약을 가져올 수 있습니다.

장기적 성능 문제: 단기적으로 성능을 향상시킬 수 있지만, 시스템이 발전하고 요구사항이 변화함에 따라 초기에 만든 성능 최적화가 오히려 성능의 병목이 될 수 있습니다.

따라서 API 설계는 성능뿐만 아니라 유지보수 가능성, 이해도, 확장성, 유연성 등 여러 측면을 고려하여 균형있게 이루어져야 합니다. 성능은 중요한 측면이지만, 전체적인 시스템 설계의 일부로 통합되어 고려되어야 합니다.
```

### 각각의 최적화 시도 전후로 성능을 축정하라
- 마이크로 벤치마킹 프레임워크 JMH

```
핵심 정리
빠른 프로그램을 작성하려 안달하지 말자.
좋은 프로그램을 작성하다 보면 성능은 따라오기 마련이다.
시스템을 설계할 때, API, 네트워크 프로토콜, 영구 저장용 데이터 포맷을 설계할 때 성능을 염두에 두어야 한다.
시스템 구현을 완료했다면 성능을 측정하자
성능이 좋지않으면 프로파일러를 사용해 문제의 원인이 되는 지점을 찾아 최적화를 수행하자
```